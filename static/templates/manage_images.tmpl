%if menu_location == "list":

	<table class="ui-widget ui-widget-content">
		%for id, name, image_location, thumb_location, date_added, date_taken, caption in image_data:			
						
			<% thumbpath = thumb_location.split('/') %>
			<tr><td imageID = "${id}" class = "image_menu_link image_menu_name">${name}</td></tr>
			<tr><td imageID = "${id}" class = "image_menu_link"><img src="${'/' + thumbpath[6] + '/' + thumbpath[7]}"></img></td></tr>	
		
		%endfor	
	</table>

	<script>

		function shortenImageNames(jQueryObject) {			
			//Take the first 10 characters from the name and strip the rest.
			for (i=0; i < jQueryObject.length; i++) {
				var image_text = $(jQueryObject[i]).html();
				var new_image_text = image_text.slice(0, 9);
				
				$(jQueryObject[i]).html(new_image_text + " ... ");
			}
		}

		//When an image is selected get the data from the image.
		$('.image_menu_link').click(function() {
			var image_id = $(this).attr('imageID');
			var returnedData = $.ajax({
								type: "POST",
								url: "/getOnePicture/",
								data: image_id
							});						

			returnedData.done(function ( response, textStatus, jqXHR) {
				$("#selected_picture").html(response);
			});

		});

		//Shorten the image names so they are only 10 characters and ...'s
		shortenImageNames( $('.image_menu_name') );		
	</script>

%endif



%if menu_location == "selected":	
	<form id = 'update_data' name = 'updated_image_data'>
		%for image_id, name, image_location, thumb_location, date_added, date_taken, caption in image_data:			
				<table class="ui-widget ui-widget-content">			
					<% thumbpath = thumb_location.split('/') %>
					<th></th><th>Added to site ${date_added} &nbsp;&nbsp;&nbsp;&nbsp;</th>
					<tr><td>&nbsp;</td></tr>
					<tr><td>Name: </td><td><input id = "picture_name" name = "name" value="${name}"></td></tr>
					<tr><td>Caption:</td>  <td><textarea name = "caption" rows = 2 cols="30">${caption}</textarea> </td></tr>
					<tr><td>Date Taken:</td> <td><input type = "text" id = "date_taken" name = "date_taken" size="8" value="${date_taken}"></input>  
						(Date Format: MM/DD/YY)</td>
					<tr><td>&nbsp;</td></tr>
					<tr><td></td><td align='center'> Associated Tags </td></tr><tr><td>&nbsp;</td></tr>

					
					%for sub_id, main_tag, sub_tag in sub_tags:
						<tr><td>Tag:</td>
								<td class = "tags">${main_tag}														
									<span style="color: #665874">-></span><span class = "sub_tag_id" dataSubID = "${sub_id}">${sub_tag}</span>

									%for event_id, parent_main_tag, parent_sub_tag, event_tag in event_tags:
										%if parent_sub_tag in sub_tag:
											<span style="color: #665874">-></span> <span class = "event_tag_id" dataEventID = "${event_id}">${event_tag}</span></td>
										%endif										
									%endfor
									<td><input id = "${image_id}" type = "button" align="center" class = "tag_delete_button" value ="X"></input></td>
					%endfor
					

					<tr><td></td><td>
						<input id = "update_image_button" type ="button" class = "image_button" value="Update"></input>	
						<input id = "delete_image_button" type = "button" class = "image_button" value="Delete"></input>
						<input id = "image_id" name = "image_id" type="hidden" value="${image_id}"></input>
					</td></tr>		
				</table>
		%endfor
	</form>

	<script>
		function sendPostData(location, data) {				
			var data = $.ajax({
					type: "POST",
					url: location,
					data: data					
				});

			return (data)
		}

		$(':button').button(); //Turn all buttons into JqueryUI buttons
		$('.image_button').css({
							"margin-top": "30px",
							"margin-left": "40px",							
							"font-size": "15px"
						});
		$('.tag_delete_button').css({
							"margin-left": "3px",
							"font-size": "10px"
		});

		//Delete an image (and all tags associated)
		$("#delete_image_button").click(function() {
			var response = confirm("Are you sure you want to completely delete this image?");

			if (response == true)
			{				
				//Send 'delete_requested' BOOLEAN to server and pass image_ID
				var data_to_delete = {
					'delete_requested': 1,
					'image_id': $(this).parents().children().filter('#image_id').val()					
				}

				var returnedData = sendPostData("/updateImageData", data_to_delete );
				
				returnedData.done(function (response, textStatus, jqXHR) {
					//If the image has been deleted reload the page
					if ( $(response).eq(0).html() == "Image Deleted"   ) {
						location.reload();
					}

					$("#selected_picture").html(response);
				});
			}
			
		});

		//Post updated image metadata values to server.
		$("#update_image_button").click(function() {
			var response = confirm("Update all image metadata?");

			if (response == true) {
				var returnedData = sendPostData("/updateImageData", $(this.form).serializeArray() );
				
				returnedData.done(function (response, textStatus, jqXHR) {					
					$("#selected_picture").html(response);
				});
			}
		});	

		$(".tag_delete_button").click(function() {
			var response = confirm("Remove this tag?");

			if (response == true) {
				var images_id = $(this).attr('id');
				//Get all of the span elements to the left of the delete button
				var tags_to_post = $(this).closest('tr').children().filter('.tags').children();			
				
				//Prepare array to pass server for deletion of ID's.
				var arrayToPush = {
								image_id: images_id, 				
								sub_tag_id: $(tags_to_post).filter('.sub_tag_id').attr('dataSubID'),		
								event_tag_id: $(tags_to_post).filter('.event_tag_id').attr('dataEventID')
				}

				var returnedData = sendPostData('/deleteTags/', arrayToPush);

				returnedData.done(function ( response, textStatus, jqXHR) {	
					//If the image has been deleted reload the page
					if ( $(response).eq(0).html() == "Image Deleted"   ) {
						location.reload();
					}
					$("#selected_picture").html(response);			
				});
			}
		});
	</script>

%endif